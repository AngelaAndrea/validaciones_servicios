<!DOCTYPE html>
<html lang="es">
  <head>
    <base target="_top">
    <meta charset="utf-8">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <style>
      :root {
        --bbva-blue: #001B61;
        --bbva-gray: #f4f5f7;
        --bbva-border: #d9d9d9;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: 'Open Sans', sans-serif;
        background-color: var(--bbva-gray);
      }

      /* Men√∫ superior personalizado */
      .menu-bar {
        background-color: #003366;
        width: 100%;
      }

      .menu-container {
        max-width: 1100px;
        margin: 0 auto;
        display: flex;
        justify-content: center;
        gap: 100px;
        padding: 10px 40px;
        font-family: 'Open Sans', sans-serif;
        font-weight: 600;
        font-size: 14px;
      }

      .menu-container a {
        color: white;
        text-decoration: none;
        position: relative;
        padding: 8px 0;
        transition: color 0.2s ease;
      }

      .menu-container a::after {
        content: '';
        position: absolute;
        left: 0;
        bottom: 0;
        height: 2px;
        width: 0%;
        background-color: #ffffff;
        transition: width 0.3s ease-in-out;
      }

      .menu-container a:hover {
        color: #aaccff;
      }

      .menu-container a:hover::after {
        width: 100%;
      }

      .top-bar {
        background-color: #ffffff;
        padding: 20px 40px;
        border-bottom: 1px solid var(--bbva-border);
        display: flex;
        align-items: center;
      }

      .top-bar img {
        height: 55px;
      }

      .main {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 60px 20px;
      }

      .form-box {
        background-color: #ffffff;
        border-radius: 16px;
        padding: 40px;
        width: 100%;
        max-width: 720px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
      }

      h1 {
        color: var(--bbva-blue);
        font-size: 24px;
        font-weight: 600;
        margin-bottom: 30px;
      }

      label {
        display: block;
        margin-top: 20px;
        font-weight: 600;
        color: #333;
      }

      input[type="text"],
      select,
      textarea {
        width: 100%;
        padding: 12px;
        margin-top: 6px;
        border-radius: 8px;
        border: 1px solid var(--bbva-border);
        background-color: #f9f9f9;
        font-size: 14px;
        font-family: 'Open Sans', sans-serif;
      }

      input:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: var(--bbva-blue);
        background-color: #fff;
      }

      select {
        height: 40px;
        font-size: 15px;
      }

      #servicesList {
        width: 100%;
        font-size: 16px;
        padding: 10px;
        box-sizing: border-box;
      }

      .field-services {
        flex: 1;
        min-width: 300px;
      }

      textarea {
        resize: vertical;
        min-height: 180px;
        font-size: 15px;
        padding: 14px;
      }

      button {
        margin-top: 30px;
        width: 100%;
        padding: 14px;
        font-size: 16px;
        font-weight: 600;
        background-color: var(--bbva-blue);
        color: white;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        transition: transform 0.15s ease-in-out, background-color 0.3s ease;
      }

      button:hover {
        background-color: #000f3e;
      }

      button:active {
        transform: scale(1.05);
      }

      .footer {
        margin-top: 20px;
        text-align: center;
        font-size: 12px;
        color: #888;
      }

      .crq-link {
        display: inline-block;
        margin-top: 16px;
        padding: 12px 18px;
        background-color: var(--bbva-blue);
        color: white;
        text-decoration: none;
        border-radius: 10px;
        font-weight: 600;
        transition: background-color 0.3s ease;
      }

      .crq-link:hover {
        background-color: #000f3e;
      }

      .error {
        color: red;
        margin-top: 12px;
        font-size: 13px;
      }

      .row-flex {
        display: flex;
        gap: 20px;
        align-items: flex-start;
        margin-bottom: 20px;
      }

      .field-crq,
      .field-services {
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      #crqInput {
        font-size: 15px;
        padding: 12px;
      }
    </style>
  </head>
  <body>

    <!-- Men√∫ superior adaptado -->
    <div class="menu-bar">
      <div class="menu-container">
        <a href="#helix">Revisar en Helix</a>
        <a href="#boletin">Revisar bolet√≠n</a>
        <a href="#vobos">Revisar Vobo's</a>
      </div>
    </div>

    <!-- Logo BBVA -->
    <div class="top-bar">
      <img src="https://1000marcas.net/wp-content/uploads/2019/12/BBVA-logo.jpg" alt="BBVA" />
    </div>

    <div class="main">
      <div class="form-box">
        <h1>Cambios de Infraestructura</h1>

        <div class="row-flex">
          <div class="field-crq">
            <label for="crqInput">Ingresa n√∫mero de CRQ:</label>
            <input type="text" id="crqInput" placeholder="Ejemplo: CRQ000101345173" />
            <div class="link-container" id="linkContainer"></div>
          </div>

          <div class="field-services">
            <label for="servicesList">Selecciona tu servicio a validar</label>
            <select id="servicesList">
              <option value="">Cargando...</option>
            </select>
          </div>
        </div>

<h3 style="margin-top: 30px; color: var(--bbva-blue); font-size: 18px; font-weight: 600;">Informaci√≥n para la validaci√≥n del cambio</h3>

<div style="display: flex; flex-direction: column; gap: 20px; font-family: 'Open Sans', sans-serif;">

  <div>
    <label for="fechaHora" style="font-weight: 600; color: #333;">Fecha y Hora de validaci√≥n</label>
    <input id="fechaHora" type="text" placeholder="dd/mm/aaaa - hh:mm" style="width: 100%; padding: 14px; font-size: 15px; border-radius: 8px; border: 1px solid #ccc; background-color: white;" />
    <small style="color: #777; font-size: 12px;">Ejemplo: 10/07/2025 - 10:00</small>
  </div>

  <div>
    <label for="valida" style="font-weight: 600; color: #333;">¬øQui√©n valida el cambio? (Nombre, ext. y cel)</label>
    <input id="valida" type="text" placeholder="Nombre completo, extensi√≥n y n√∫mero celular" style="width: 100%; padding: 14px; font-size: 15px; border-radius: 8px; border: 1px solid #ccc; background-color: white;" />
  </div>

  <div>
    <label for="subdirector" style="font-weight: 600; color: #333;">Subdirector (Nombre, ext. y cel)</label>
    <input id="subdirector" type="text" placeholder="Nombre completo, extensi√≥n y n√∫mero celular" style="width: 100%; padding: 14px; font-size: 15px; border-radius: 8px; border: 1px solid #ccc; background-color: white;" />
  </div>

  <div>
    <label for="director" style="font-weight: 600; color: #333;">Director (Nombre, ext. y cel)</label>
    <input id="director" type="text" placeholder="Nombre completo, extensi√≥n y n√∫mero celular" style="width: 100%; padding: 14px; font-size: 15px; border-radius: 8px; border: 1px solid #ccc; background-color: white;" />
  </div>

</div>



<div id="successMessage" style="display: none; color: green; font-weight: 600; margin-top: 20px;">
  ‚úÖ Tu cambio fue registrado con √©xito
</div>

        <button onclick="submitData()">Enviar</button>

        <div class="footer">Uso interno BBVA ‚Äì Infraestructura</div>
      </div>
    </div>

    <script>
      const baseUrl = "https://itsmhelixbbva-smartit.onbmc.com/smartit/app/#/search/";
      const input = document.getElementById("crqInput");
      const linkContainer = document.getElementById("linkContainer");

      input.addEventListener("input", () => {
        const crq = input.value.trim().toUpperCase();
        linkContainer.innerHTML = "";

        if (crq.length > 0) {
          const regex = /^CRQ\d+$/;
          if (regex.test(crq)) {
            const url = baseUrl + crq;
            linkContainer.innerHTML = `<a href="${url}" target="_blank" class="crq-link">üîç Ver CRQ ${crq}</a>`;
          } else {
            linkContainer.innerHTML = `<div class="error">‚ùå Formato inv√°lido. Usa algo como: CRQ000101345173</div>`;
          }
        }
      });
 document.addEventListener("DOMContentLoaded", function () {
    google.script.run.withSuccessHandler(function (services) {
      const list = document.getElementById("servicesList");
      list.innerHTML = "";
      services.forEach(service => {
        const opt = document.createElement("option");
        opt.textContent = service;
        opt.value = service;
        list.appendChild(opt);
      });
    }).getServicesFromSheet();
  });

  function submitData() {
  const crqNumber = document.getElementById("crqInput").value.trim(); // <- este es el campo CRQ
  const servicio = document.getElementById("servicesList").value;
  const fechaHora = document.getElementById("fechaHora").value;
  const valida = document.getElementById("valida").value;
  const subdirector = document.getElementById("subdirector").value;
  const director = document.getElementById("director").value;

  if (!crqNumber || !servicio || !fechaHora || !valida) {
    alert("Por favor llena todos los campos obligatorios.");
    return;
  }

  // ‚úÖ Incluye el n√∫mero de CRQ en la llamada
  google.script.run.saveValidationData(crqNumber, servicio, fechaHora, valida, subdirector, director);
  alert("‚úÖ Informaci√≥n enviada correctamente.");

  // Limpiar campos
  document.getElementById("crqInput").value = "";
  document.getElementById("servicesList").selectedIndex = -1;
  document.getElementById("fechaHora").value = "";
  document.getElementById("valida").value = "";
  document.getElementById("subdirector").value = "";
  document.getElementById("director").value = "";
}


</script>
`
    </script>
  </body>
</html>
